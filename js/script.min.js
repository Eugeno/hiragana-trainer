"use strict";var kana=0;var score=0;var falls=0;var ENTER_KEY_CODE=13;var ESCAPE_KEY_CODE=27;var kotae=document.querySelector(".kotae");var shitsumon=document.querySelector(".shitsumon");var tip=document.querySelector(".tip");var rules=document.querySelector(".rules");var rulesLink=document.querySelector(".rules-link");var rulesOverlay=document.querySelector(".rules-overlay");var winPopup=document.querySelector(".win");var winOverlay=document.querySelector(".win-overlay");var answers=[["а","a"],["и","i"],["у","u"],["э","e","е"],["о","o"],["ка","ka"],["ки","ki"],["ку","ku"],["кэ","ke","ке"],["ко","ko"],["са","sa"],["си","shi","si"],["су","su"],["сэ","se","се"],["со","so"],["та","ta"],["ти","chi"],["цу","tsu"],["тэ","te","те"],["то","to"],["на","na"],["ни","ni"],["ну","nu"],["нэ","ne","не"],["но","no"],["ха","ha"],["хи","hi"],["фу","fu"],["хэ","he","хе"],["хо","ho"],["ма","ma"],["ми","mi"],["му","mu"],["мэ","me","ме"],["мо","mo"],["я","ya"],["ю","yu"],["ё","yo"],["ра","ra"],["ри","ri"],["ру","ru"],["рэ","re","ре"],["ро","ro"],["ва","wa"],["о","o","во","wo"],["н","n"]];var questions=[];for(var i=0;i<answers.length;i++){questions.push(i+1)}var currentOrder=[];var shuffleOrder=function(e){var b=e.slice();var a=[];for(var d=0;d<e.length;d++){var c=Math.floor(Math.random()*b.length);a.push(b[c]);b.splice(c,1)}return a};var updateOrder=function(c,a){for(var b=0;b<c.length;b++){a.splice(a.indexOf(c[b]),1)}return a.concat(c)};currentOrder=shuffleOrder(questions);var newQuestion=function(){shitsumon.classList.remove("k"+kana);shitsumon.classList.remove("right");kotae.value="";kotae.removeAttribute("disabled");kotae.focus();kana=currentOrder[currentOrder.length-1];shitsumon.classList.add("k"+kana)};newQuestion();kotae.addEventListener("keyup",function(a){if(a.keyCode===ENTER_KEY_CODE){if(a.currentTarget.value.length!==0){if(answers[kana-1].indexOf(a.currentTarget.value)>-1){a.currentTarget.classList.remove("wrong");a.currentTarget.setAttribute("disabled","true");if(falls===0){currentOrder.pop()}if(currentOrder.length<5){currentOrder=updateOrder(currentOrder,shuffleOrder(questions))}falls=0;score++;if(score<20){shitsumon.classList.add("right");setTimeout(newQuestion,400)}else{win()}}else{a.currentTarget.classList.add("wrong");shitsumon.classList.add("wrong");setTimeout(function(){shitsumon.classList.remove("wrong")},700);if(falls===0){currentOrder.pop();currentOrder[currentOrder.length]=currentOrder[currentOrder.length-3];currentOrder[currentOrder.length-4]=kana}score=0;falls++}}if(falls>2){tip.classList.add("active")}else{tip.classList.remove("active")}}});kotae.addEventListener("input",function(a){a.currentTarget.classList.remove("wrong")});var win=function(){winOverlay.classList.add("active");winPopup.classList.add("active");winPopup.querySelector(".again").addEventListener("click",trainAgain)};var trainAgain=function(){score=0;winOverlay.classList.remove("active");winPopup.classList.remove("active");newQuestion();winPopup.querySelector(".again").removeEventListener("click",trainAgain)};rulesLink.addEventListener("click",function(){rules.classList.toggle("active");rulesOverlay.classList.toggle("active");if(!rules.classList.contains("active")){kotae.focus();document.removeEventListener("keydown",rulesEscHandler)}else{document.addEventListener("keydown",rulesEscHandler)}});var hideRules=function(){rules.classList.remove("active");rulesOverlay.classList.remove("active");document.removeEventListener("keydown",rulesEscHandler);kotae.focus()};var rulesEscHandler=function(a){if(a.keyCode===ESCAPE_KEY_CODE){hideRules()}};rulesOverlay.addEventListener("click",hideRules);rules.querySelector(".close").addEventListener("click",hideRules);document.querySelector(".focus-overlay").addEventListener("click",function(){kotae.focus()});